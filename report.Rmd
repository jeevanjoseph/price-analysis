---
title: "Statistical Predictive Model for Automobile Pricing"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Abstract

In this paper, I study classified adverisement data to build a reusable statistical
model for price prediction of automobiles. Teh data set is cleaned and filtered to 
limit the study to main stream consumer automobiles. The industry's reliance on 
proprietary databases and the lack of transparency around the currently avaialable
valuation models provide motivation to build an open data model for valuation.
Such a model will be free from any potential conflicts of interests, and will be 
fully transparent.

In this paper, I use the dataset that collects classified advertisements from 
the website craigslist.org. I prepare the data for analysis, perform exploratory 
analysis, and finally build a reusable predictive model. 


## Research Question
Can we build a resusable statistical model to perform automobile valuations based purely on open data ?

The automotive segment is dominated by
dealers and middlemen who often inflate pricing and make it difficult to understand 
the true market worth of an automobile. There are proprietary databases in the 
domain, however they use closed data sources and monetize the database to provide
sales tools for dealerships which make them less transparent (Kelley Blue Book Inc.). 

This study is aimed at creating a valuation model based on open-data from classified
advertisements. Studies have shown that users prefer third party price evaluations
than the dealershipâ€™s price evaluations and can have a positive impact on the 
sale itself (Cox Automotive Inc.). I believe this study provides a valuable vector 
in building an open and comprehensive model that makes the data transparent and 
free of any conflicts of interest.

### Setup

First we ensure that the required packages for our analysis are installed.
```{r}
#install.packages("tidyverse")
library(tidyr)
library(readr)
library(dplyr)
library(ggplot2)
source("ford.R", local = TRUE)
```


## Exploratory Data analysis

In this stage of the study, we load and summarize the data. We develop a better 
understanding of the extreme and abberant values in the dataset and detect and 
eliminate outliers that do not contribute to the model or are incorrectly recorded.

We also break down the data by the manufacturer and eliminate exotic and classic 
cars from the list to avoid skew, as these vehicles do not usually follow the 
same valuation as mainstream consumer automobiles. 

### Loading the data

Now we load the data. The data load uses the `read_csv` function from the `dplyr` package.
```{R}
data <- read_csv("craigslistVehicles_semi.csv");
```


Lets quickly summarise the data that was loaded
```{R}
summary(data);
#plot(as.numeric(data$year),as.numeric(data$odometer))
#levels(data$type)
#summary(data$type)
#data %>%group_by(type)%>%summarise(count = n()) %>% View
```

### Remove incomplete observations from the dataset

We can see from the summary that we have observations in our dataset that are incomplete. 
We have `NA`s for several variables, and we shall remove these incomplete observations.
``` {R}
#complete <- data[complete.cases(data),]
complete <- data %>%  
    drop_na(odometer) %>%
    drop_na(year) %>%
    drop_na(make) %>%
    drop_na(manufacturer)
```

Now that we have done a bit more clean up, lets get some summary stats for the manufacturers
```{R}

# clean manufacturers

complete %>% group_by(manufacturer)%>%summarise(count = n())
sig_manu <- complete %>% group_by(manufacturer)%>%summarise(count = n()) %>% filter(count>1000)

complete <- complete %>% filter(manufacturer %in% sig_manu$manufacturer)
#complete %>% group_by(manufacturer)%>%summarise(count = n()) %>% View
```

### Understanding the Price distribution
```{R}
# clean price

#complete$price <-with(complete,as.numeric(as.character(price)))
quantile(complete$price,probs = seq(0,1,.01))
quantile(complete$price,.05)
summary(complete$price)
price_dist<-complete %>%filter(price< quantile(complete$price,.99)) %>% group_by(price) %>% summarise(count = n()) 
```
Lets plot the distribution of the prices
```{R}
ggplot(data=price_dist,aes(x=price,y=count)) + geom_point()
```
We can still see some of the extreme observations on te lower end. Specifically, there are many observations that have a `price` of `0`. These typically mean that the seller is trying to negotiate the best offer from potential buyers. We can see that upto the 10th percentile, the `price` is `0`. We are excluding these observations, as the price is not indicative of the actual expected sale price.

```{r}
price_dist<-complete %>%filter(price > quantile(complete$price,.1) & price < quantile(complete$price,.95)) %>% group_by(price) %>% summarise(count = n()) 
ggplot(data=price_dist,aes(x=price,y=count)) + geom_point()
```

[ford]["https://www.ford.com"]
